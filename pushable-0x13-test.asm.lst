0001   0000             ; Run in Mode 2, Multiplexed/RAM/No ROM, P20: L, P21: H, P22: L
0002   0000             ;
0003   0000             ;Current theory 0x13 is 3-bytes STR offset,X,immediate (indexed by X)
0004   0000             ;
0005   0000                                 .msfirst
0006   0000             ;
0007   0000             ;RAM
0008   0000             RAM_BBU_BOT         .equ    $0040       ;The bottom of "Battery Backup" RAM
0009   0000             RAM_BBU_TOP         .equ    $0056       ;The top of "Battery Backup" RAM
0010   0000             RAM_VIO_BOT         .equ    $0057       ;The bottom of "violate" RAM
0011   0000             RAM_VIO_TOP         .equ    $01BF       ;The top of "violate" RAM
0012   0000             ;
0013   0000             
0014   0000             ;
0015   0000             ;Subroutines in ROM
0016   0000             PCHAR               .equ    $8054
0017   0000             RCHAR               .equ    $805F
0018   0000             PSTR                .equ    $8068
0019   0000             CLRACC              .equ    $8089
0020   0000             ;
0021   0000             START               .equ    RAM_VIO_BOT
0022   0000             ;
0023   0057                                 .org    START
0024   0057 CE 00 40                        ldx     #RAM_BBU_BOT
0025   005A A7 00       CLR_RAM             staa    $00,x
0026   005C 08                              inx
0027   005D 8C 00 56                        cpx     #RAM_BBU_TOP
0028   0060 23 F8                           bls     CLR_RAM
0029   0062 86 01                           ldaa    #$01         ;marker
0030   0064 BD 80 54                        jsr     PCHAR
0031   0067 CC 00 00    INST_TEST           ldd     #$0000
0032   006A CD CE 00 00                     ldy     #$0000       ;Using Y as a loop counter
0033   006E CE 00 40                        ldx     #RAM_BBU_BOT
0034   0071 CD 08       CLR_N_TEST          iny
0035   0073 13 00 55                        .byte   $13, $00, $55
0036   0076 07                              tpa
0037   0077 BD 80 54                        jsr     PCHAR
0038   007A 08                              inx
0039   007B                                 ;inx
0040   007B CD 8C 00 16                     cmpy    #$0016       ;Finish after three loops
0041   007F 25 F0                           bcs     CLR_N_TEST
0042   0081 86 01                           ldaa    #$01         ;marker
0043   0083 BD 80 54                        jsr     PCHAR
0044   0086 CE 00 40                        ldx     #RAM_BBU_BOT
0045   0089 A6 00       DUMP_MEM            ldaa    $00,x
0046   008B BD 80 54                        jsr     PCHAR
0047   008E 08                              inx
0048   008F 8C 00 56                        cpx     #RAM_BBU_TOP
0049   0092 23 F5                           bls     DUMP_MEM
0050   0094 39                              rts
0051   0095                                 .end
# tasm: Number of errors = 0
